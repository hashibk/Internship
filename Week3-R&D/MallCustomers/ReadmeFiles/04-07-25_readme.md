# 🧠 Mall Customers Segmentation & Classification Pipeline (RandomForest & LightGBM)

This notebook builds a **modular machine learning pipeline** to cluster and classify mall customers based on their demographics and purchasing behavior using:
- PCA + KMeans for clustering
- RandomForest and LightGBM for classification

---

## 📁 Dataset

**Mall_Customers.csv**

Contains the following columns:
- `CustomerID` (dropped for modeling)
- `Genre` (categorical)
- `Age`
- `Annual Income (k$)`
- `Spending Score (1-100)`

---

## 🔄 Workflow Summary

### 📌 Step 1: Data Preprocessing
- Drop `CustomerID` column
- Encode `Genre` using `LabelEncoder`
- Outlier removal using **IQR method**
- Define categorical and numerical features
- Construct a `ColumnTransformer` with:
  - `StandardScaler` for numeric features
  - `OneHotEncoder` (drop='first') for categorical features

---

### 📌 Step 2: Clustering Pipeline

**Pipeline Components:**
- Preprocessing (ColumnTransformer)
- PCA (2 components)
- KMeans (k=4)

**Notes:**
- Trained only on the training split (75%)
- Used `.predict()` to derive cluster labels for both `X_train` and `X_test`
- Saved full pipeline using `joblib`

```bash
joblib.dump(pipe_clust, "cluster_pipeline.joblib")
📌 Step 3: Classification Models
Target variable: Cluster labels derived from the clustering pipeline

✅ Random Forest Pipeline

Pipeline:

Preprocessing
RandomForestClassifier
Hyperparameters Tuned via GridSearchCV:

n_estimators: 100, 200
max_depth: None, 10, 20
min_samples_split: 2, 5
min_samples_leaf: 1, 2
CV Strategy: StratifiedKFold with 5 folds

✅ LightGBM Pipeline

Pipeline:

Preprocessing
LightGBMClassifier (multiclass objective)
Hyperparameters Tuned via GridSearchCV:

n_estimators: 100, 200
learning_rate: 0.05, 0.1
max_depth: 3, 5
num_leaves: 31, 63
📌 Step 4: Evaluation
Function Used:

accuracy_score
classification_report
confusion_matrix (with heatmap)
Both models were evaluated on the test set (25%) using:

Accuracy
Precision/Recall/F1
Confusion Matrix (via Seaborn heatmap)
📌 Step 5: Predicting a New Customer
Example:

new_customer = pd.DataFrame(
    [[1, 30, 70, 60]],
    columns=["Genre", "Age", "Annual Income (k$)", "Spending Score (1-100)"]
)
Prediction is made using the RandomForest classifier trained on clusters.

pred_cluster = best_rf.predict(new_customer)[0]
print("Predicted segment:", pred_cluster)
📦 Requirements

pandas
numpy
seaborn
matplotlib
scikit-learn
lightgbm
joblib
Install using:

pip install pandas numpy seaborn matplotlib scikit-learn lightgbm joblib
💾 Saved Files

cluster_pipeline.joblib: Clustering pipeline (preprocessing + PCA + KMeans)
Additional .joblib files can be created for best_rf and best_lgbm if needed
🧩 File Structure

04-07-25_Pipelines_MallCustomers.ipynb  # Main notebook
Mall_Customers.csv                      # Input dataset
cluster_pipeline.joblib                 # Saved clustering pipeline
readme.md                               # This file